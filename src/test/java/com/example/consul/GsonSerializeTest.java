package com.example.consul;

import com.example.consul.dto.OZON.OZON_PerformanceReport;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.google.gson.Gson;
import com.google.gson.internal.LinkedTreeMap;
import com.google.gson.reflect.TypeToken;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import java.lang.reflect.Type;
import java.util.ArrayList;
import java.util.List;

@SpringBootTest
public class GsonSerializeTest {
    @Test
    void serializeTest() {
        String json = "{\"823008\":{\"title\":\"Кампания по продвижению товаров № 823008, период 01.01.2024-31.01.2024\",\"report\":{\"rows\":[],\"totals\":{\"views\":\"0\",\"clicks\":\"0\",\"ctr\":\"0,00\",\"moneySpent\":\"0,00\",\"avgBid\":\"0,00\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\"}}},\"881913\":{\"title\":\"Кампания по продвижению товаров № 881913, период 01.01.2024-31.01.2024\",\"report\":{\"rows\":[{\"date\":\"Янв 2024\",\"views\":\"249784\",\"clicks\":\"4664\",\"ctr\":\"1,87\",\"moneySpent\":\"12688,87575\",\"avgBid\":\"50,80\",\"orders\":\"36\",\"ordersMoney\":\"202294,00\",\"models\":\"37\",\"modelsMoney\":\"204201,00\",\"sku\":\"477040103\"},{\"date\":\"Янв 2024\",\"views\":\"1297\",\"clicks\":\"39\",\"ctr\":\"3,01\",\"moneySpent\":\"64,85\",\"avgBid\":\"50,00\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"477040104\"},{\"date\":\"Янв 2024\",\"views\":\"2917\",\"clicks\":\"41\",\"ctr\":\"1,41\",\"moneySpent\":\"145,6228\",\"avgBid\":\"49,92\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"5\",\"modelsMoney\":\"29120,00\",\"sku\":\"477045988\"},{\"date\":\"Янв 2024\",\"views\":\"11350\",\"clicks\":\"246\",\"ctr\":\"2,17\",\"moneySpent\":\"566,0112\",\"avgBid\":\"49,87\",\"orders\":\"3\",\"ordersMoney\":\"15777,00\",\"models\":\"7\",\"modelsMoney\":\"39739,00\",\"sku\":\"477053086\"},{\"date\":\"Янв 2024\",\"views\":\"1168\",\"clicks\":\"20\",\"ctr\":\"1,71\",\"moneySpent\":\"59,78245\",\"avgBid\":\"51,18\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"1\",\"modelsMoney\":\"7295,00\",\"sku\":\"477053910\"},{\"date\":\"Янв 2024\",\"views\":\"2249\",\"clicks\":\"33\",\"ctr\":\"1,47\",\"moneySpent\":\"112,54205\",\"avgBid\":\"50,04\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"477054355\"},{\"date\":\"Янв 2024\",\"views\":\"38732\",\"clicks\":\"788\",\"ctr\":\"2,03\",\"moneySpent\":\"1927,8197\",\"avgBid\":\"49,77\",\"orders\":\"16\",\"ordersMoney\":\"91511,00\",\"models\":\"18\",\"modelsMoney\":\"102912,00\",\"sku\":\"477056233\"},{\"date\":\"Янв 2024\",\"views\":\"150152\",\"clicks\":\"3118\",\"ctr\":\"2,08\",\"moneySpent\":\"13955,21618\",\"avgBid\":\"92,94\",\"orders\":\"10\",\"ordersMoney\":\"59711,00\",\"models\":\"39\",\"modelsMoney\":\"220257,00\",\"sku\":\"477056244\"},{\"date\":\"Янв 2024\",\"views\":\"6989\",\"clicks\":\"68\",\"ctr\":\"0,97\",\"moneySpent\":\"369,54735\",\"avgBid\":\"52,88\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"477059602\"},{\"date\":\"Янв 2024\",\"views\":\"22045\",\"clicks\":\"493\",\"ctr\":\"2,24\",\"moneySpent\":\"1120,95985\",\"avgBid\":\"50,85\",\"orders\":\"4\",\"ordersMoney\":\"20683,00\",\"models\":\"3\",\"modelsMoney\":\"14905,00\",\"sku\":\"477059613\"},{\"date\":\"Янв 2024\",\"views\":\"9505\",\"clicks\":\"284\",\"ctr\":\"2,99\",\"moneySpent\":\"485,5649\",\"avgBid\":\"51,09\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"562722522\"},{\"date\":\"Янв 2024\",\"views\":\"8117\",\"clicks\":\"330\",\"ctr\":\"4,07\",\"moneySpent\":\"415,25455\",\"avgBid\":\"51,16\",\"orders\":\"3\",\"ordersMoney\":\"13350,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"563488949\"},{\"date\":\"Янв 2024\",\"views\":\"1637\",\"clicks\":\"22\",\"ctr\":\"1,34\",\"moneySpent\":\"81,81985\",\"avgBid\":\"49,98\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"589813941\"},{\"date\":\"Янв 2024\",\"views\":\"5062\",\"clicks\":\"64\",\"ctr\":\"1,26\",\"moneySpent\":\"252,9638\",\"avgBid\":\"49,97\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"3\",\"modelsMoney\":\"17282,00\",\"sku\":\"690261470\"},{\"date\":\"Янв 2024\",\"views\":\"6773\",\"clicks\":\"112\",\"ctr\":\"1,65\",\"moneySpent\":\"391,0984\",\"avgBid\":\"57,74\",\"orders\":\"5\",\"ordersMoney\":\"26992,00\",\"models\":\"2\",\"modelsMoney\":\"12020,00\",\"sku\":\"690283969\"},{\"date\":\"Янв 2024\",\"views\":\"4604\",\"clicks\":\"58\",\"ctr\":\"1,26\",\"moneySpent\":\"242,97715\",\"avgBid\":\"52,78\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"714947153\"},{\"date\":\"Янв 2024\",\"views\":\"14250\",\"clicks\":\"324\",\"ctr\":\"2,27\",\"moneySpent\":\"722,715\",\"avgBid\":\"50,72\",\"orders\":\"1\",\"ordersMoney\":\"9730,00\",\"models\":\"1\",\"modelsMoney\":\"10352,00\",\"sku\":\"714972500\"},{\"date\":\"Янв 2024\",\"views\":\"7676\",\"clicks\":\"104\",\"ctr\":\"1,35\",\"moneySpent\":\"390,95505\",\"avgBid\":\"50,93\",\"orders\":\"1\",\"ordersMoney\":\"10300,00\",\"models\":\"1\",\"modelsMoney\":\"9579,00\",\"sku\":\"714988312\"},{\"date\":\"Янв 2024\",\"views\":\"788\",\"clicks\":\"21\",\"ctr\":\"2,66\",\"moneySpent\":\"40,39735\",\"avgBid\":\"51,27\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"715008334\"},{\"date\":\"Янв 2024\",\"views\":\"3807\",\"clicks\":\"59\",\"ctr\":\"1,55\",\"moneySpent\":\"193,22715\",\"avgBid\":\"50,76\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"1\",\"modelsMoney\":\"9730,00\",\"sku\":\"715013890\"},{\"date\":\"Янв 2024\",\"views\":\"4912\",\"clicks\":\"74\",\"ctr\":\"1,51\",\"moneySpent\":\"249,01225\",\"avgBid\":\"50,69\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"726271451\"},{\"date\":\"Янв 2024\",\"views\":\"4015\",\"clicks\":\"67\",\"ctr\":\"1,67\",\"moneySpent\":\"203,2649\",\"avgBid\":\"50,63\",\"orders\":\"3\",\"ordersMoney\":\"28488,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"726732512\"},{\"date\":\"Янв 2024\",\"views\":\"448\",\"clicks\":\"10\",\"ctr\":\"2,23\",\"moneySpent\":\"22,98245\",\"avgBid\":\"51,30\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"726791319\"},{\"date\":\"Янв 2024\",\"views\":\"1595\",\"clicks\":\"41\",\"ctr\":\"2,57\",\"moneySpent\":\"81,9639\",\"avgBid\":\"51,39\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"726793720\"},{\"date\":\"Янв 2024\",\"views\":\"2086\",\"clicks\":\"23\",\"ctr\":\"1,10\",\"moneySpent\":\"107,35\",\"avgBid\":\"51,46\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"730672417\"},{\"date\":\"Янв 2024\",\"views\":\"900\",\"clicks\":\"20\",\"ctr\":\"2,22\",\"moneySpent\":\"46,45\",\"avgBid\":\"51,61\",\"orders\":\"0\",\"ordersMoney\":\"0,00\",\"models\":\"0\",\"modelsMoney\":\"0,00\",\"sku\":\"739438741\"}],\"totals\":{\"views\":\"562858\",\"clicks\":\"11123\",\"ctr\":\"1,98\",\"moneySpent\":\"34099,99403\",\"avgBid\":\"60,58\",\"orders\":\"82\",\"ordersMoney\":\"478836,00\",\"models\":\"118\",\"modelsMoney\":\"677392,00\",\"corrections\":\"-839,23\"}}}}\n";

        Type type = new TypeToken<LinkedTreeMap<String, Object>>(){}.getType();
        LinkedTreeMap<String, Object> test = new Gson().fromJson(json, type);
        List<OZON_PerformanceReport> reports = new ArrayList<>();

        for (String key : test.keySet()) {
            ObjectMapper objectMapper = new ObjectMapper();
            OZON_PerformanceReport report = objectMapper
                    .convertValue(test.get(key), new TypeReference<>() {
                    });
            report.setId(key);
            reports.add(report);
        }

        System.out.println(reports);
    }
}
